- 什么是CAP？
一致性 可用性 分区容错性

- 简述一下GFS的一致性策略？
元数据的写入是加锁串行的
无并发写一个chunk的时候，当三个副本全部写成功的时候才会返回成功，否则返回失败
这将导致GFS系统中文件的不一致性
有并发的时候由primary决定写的顺序，所有的副本按照这个顺序执行，保证最终一致
注意！串行成功是一致已定义的，并行成功是一致未定义的

- master恢复
master的历史信息使用快照存储，最近的操作使用日志存储

- GFS如何进行快照？
首先master取消对当前chunk的租约，保证对chunk的修改通过master进行
之后创建快照 维护对于chunk的引用计数
后续计数>2，则分开独立访问

- GFS文件系统结构？
GFS组织成树的结构，修改文件需要获得父亲节点的读锁和子节点的读写锁
文件惰性删除，文件重命名为包含时间戳的隐藏文件名，在例行的文件空间扫描中才会删除
这样删除更加可靠，cpu使用更加平衡，为人为的误操作兜底

- GFS如何保证高可用？
服务快速拉起，master和chunk server都设计成秒级启动
chunk复制策略，保证数据不丢
master节点建设主备，client操作在主master和从master全部落盘后才返回，外部监控进程监控master状态并在master故障后选择新的master升主

- GFS如何保证数据完整性？
chunk server将chunk切成64KB大小的块，并为每个块维护一个32位的checksum。对读操作，数据返回client之前会检查checksum。对写操作，需要对写范围有覆盖的第一个64KB块和最后一个先进行校验，防止原来存在损坏的数据被本次写隐藏了，然后进行实际写入并重新计算checksum。chunk server空闲时会对所有chunk做整体扫描，尤其针对一个不活动的chunk，防止master认为chunk已经有足够的副本数量了但是实际上副本内容已经损坏。

- 状态备份的两种方式？
状态转移（State transfer） 持续增量同步 Primary 的状态到 Backup，包括CPU、内存、IO设备等等；但是这些状态通常所占带宽很大，尤其是内存变化。
冗余状态机（Replicated State Machine） 将服务器看作是一个具有确定性状态的状态机，只要给定相同初始状态和同样顺序的确定输入，就能保持同样的状态。同步的是外部的事件/操作/输入；同步的内容通常较小，但是依赖主机的一些特性：比如指令执行的确定性（deterministic）。而在物理机上保证确定性很难，但是在 VM 上就简单的多，由于 hypervisor 有对 VM 有完全的控制权，因此可以通过某些手段来额外同步某些不确定性输入（比如类似随机数、系统时钟等）。

- 如何解决复制状态机中primary和backup不一致的问题？
控制输出，保证状态一致后响应成功

- VM-FT如何解决重复输出的问题？
TCP栈序列号/检验重复的机制

- VM-FT如何解决split brain？
三方机构Test-and-Set，Test-and-Set服务就是一个仲裁官，决定了两个副本中哪一个应该上线 通过标志位实现

- raft 如何进行leader选举？
使用随机计时器


- 为什么要有raft？它用来解决什么问题？
raft是一个一致性算法，
复制状态机（replicated state machines）用于对有单个集群leader的大型系统进行leader选举和配置信息的存储。复制状态机通常使用复制日志实现，一致性算法的任务是保证复制日志的一致性。

- 共识算法的特性有哪些？
1. 在网络延迟、分区和包丢失、复制和重排序条件下保证安全性（永远返回正确的结果）
2. 只要大多数服务器可操作、可通信那么就是完全可用的
3. 不依赖时间来保证一致性
4. 少数速度较慢的服务器不影响整体系统性能

- ※raft如何实现一致性？
首先选举一位leader leader有管理复制日志的责任，接受来自客户的日志条目，在其它服务器上复制它们。
这样就把一致性问题分为了三个子问题：leader选举，日志复制与一致性，安全性




