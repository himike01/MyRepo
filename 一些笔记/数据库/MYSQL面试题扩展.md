
- 说一下GROUP BY和ORDER BY的区别？
  ORDER BY给出的是排序的输出，GROUP BY则是分组后的输出（不一定排好！）
- 如何使得UNION不过滤掉重复的行？
  使用UNION ALL
- 如何进行全文本搜索？
  首先使用FULLTEXT标记索引列，之后使用Match()和Against()进行匹配
- 说一下全文本搜索是如何进行排序的？
  全文本索引使用Match()和Against()维护一个rank值，这个值由搜索到的字符频率和重要度划分，决定了全文本搜索的排序。
- 更新sql发生错误，但是仍然继续更新的关键字是什么?
  Ignore
- 如何在一次查询中将两个字段组合到一起？
  使用concat
- 视图了解吗？说一下如何创建视图
  CREATE VIEW viewname AS
- 视图可以被更新吗？
  视情况而定。在使用了分组，连结，并，子查询等条件下，视图不会被更新。
- 了解存储过程吗？存储过程如何定义？如何调用？如何删除？
  创建：
  CREATE PROCEDURE procedure_name(参数列表)
  BEGIN
    PROCESS
  END;
  调用：
  call procedure_name;
  删除：
  drop procedure_name;
- 了解游标吗？
  用于存储过程的
- 触发器名字如何规范？
  sql要求每一个表中有唯一的触发器名字，但是为了规范和可复用，建议每个数据库一个触发器名
- 如何在事务中设置保留点？
  使用SAVEPOINT
  
- 索引类型
主键索引，单列索引，唯一索引，复合索引

- 数据库的行锁，表锁，间隙锁，死锁
行锁有两种：共享锁，排他锁
共享锁相当于读锁
排他锁相当于写锁
表锁比行锁开销更小
行锁是通过索引加锁实现的

间隙锁是为了防止幻读，阻止在范围数据后面增加删除数据

- MVCC
为了提高数据库性能实现的无锁数据查询
在读未提交和可重复读时可以使用
主要使用read-view，undo日志，和版本链实现的

- explain关键字
https://blog.csdn.net/zhxp_870516/article/details/8434352

- 数据库的隔离级别如何实现的?
1.使用LBCC 诸如表锁，行锁，间隙锁等机制
2.使用MVCC 事务并发控制，版本链，日志 快照读，当前读等机制
只使用快照读的时候没有幻读的问题

- 分布式session如何实现？
1. session复制，web容器的自带功能
2. session绑定，nginx反向代理绑定session服务器
3. Redis存储 spring-session
4. 客户端存储

- 最大连接数设定有什么影响？
最大连接数应该设置为2*核数+磁盘阵列磁盘数


- 聚集索引的建立流程是什么？
（1）如果表定义了PK，则PK就是聚集索引；
（2）如果表没有定义PK，则第一个not NULL unique列是聚集索引；
（3）否则，InnoDB会创建一个隐藏的row-id作为聚集索引；


- 如何避免回表查询？
使用联合索引，将被查询的字段，建立到联合索引里去


- 如何建立聚集索引？
create CLUSTERED INDEX 索引名称 ON 表名(字段名)
ALTER TABLE table_name ADD PRIMARY KEY (column_list)

- 联合索引的执行流程是怎么样的？
先是最左匹配，然后不符合条件的部分会进行回表查询，这个过程也会执行索引下推

- 什么叫索引下推？
索引下推优化（index condition pushdown)， 可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数
在非主键索引查找的过程中就已经进行了后续字段的判断。

- 三范式，分别解决了什么问题
原子性，一个字段只做一件事——解耦，防止冗余
保证一张表只描述一件事情
保证每列都和主键直接相关


- 共享锁排他锁的加锁语句分别是什么？
for update
in share mode


- innodb行锁锁的是什么？
索引。

- 什么叫意向共享锁和意向排他锁？
获得共享锁/排他锁之前，需要得到意向锁
作用是优化锁之间的性能 解决表锁与之前可能存在的行锁冲突，避免为了判断表是否存在行锁而去扫描全表的系统消耗。


- 自增锁
事务中没有提交的自增id也会丢失掉

- 临键锁和间隙锁的加锁时机

- 记录锁
匹配的行级锁

- 联合索引的底层结构？
联合索引(A,B,C)是一棵B+Tree，其非叶子节点存储的是第一个关键字的索引，而叶节点存储的则是三个关键字A、B、C三个关键字的数据，且按照A、B、C的顺序进行排序。

- MySQL中是如何实现事务提交和回滚的？
redo log
redo log是重做日志，通常是物理日志，记录的是物理数据页的修改，它用来恢复提交后的物理数据页
undo log
undo log是回滚日志，用来回滚行记录到某个版本，undo log一般是逻辑日志，根据行的数据变化进行记录

为了保证数据的持久性，数据库在执行SQL操作数据之前会先记录redo log和undo log
redo log是重做日志，通常是物理日志，记录的是物理数据页的修改，它用来恢复提交后的物理数据页
undo log是回滚日志，用来回滚行记录到某个版本，undo log一般是逻辑日志，根据行的数据变化进行记录
redo/undo log都是写先写到日志缓冲区，再通过缓冲区写到磁盘日志文件中进行持久化保存
undo日志还有一个用途就是用来控制数据的多版本（MVCC）
简单理解就是：
redo log是用来恢复数据的，用于保障已提交事务的持久性                                                           
undo log是用来回滚事务的，用于保障未提交事务的原子性



- 数据库连接数大小设置
连接数=((CPU核心数*2)+磁盘阵列数)

- explain得到什么字段？
查询id，查询类型，表类型，表名，可能选择的索引
最重要的是type列，
包括system，const，eq_ref，ref，fulltext，ref_or_null，index_merge，unique_subquery，index_subquery，range，index，ALL等等类型。

- 什么是倒排索引？
倒排索引源于实际应用中需要根据属性的值来查找记录。这种索引表中的每一项都包括一个属性值和具有该属性值的各记录的地址。由于不是由记录来确定属性值，而是由属性值来确定记录的位置，因而称为倒排索引(inverted index)。

- 数据库有什么锁？
latch
latch一般称为闩锁（轻量级的锁），因为其要求锁定的时间必须非常短。若持续的时间长，则应用的性能会非常差。在InnoDB存储引擎中，latch又可以分为mutex（互斥量）和rwlock（读写锁）。其目的是用来保证并发线程操作临界资源的正确性，并且通常没有死锁检测的机制。
lock
分为乐观锁和悲观锁
乐观锁可以用CAS实现
悲观锁分为范围锁，属性锁，意向锁
范围锁包括行锁和表锁
表锁包括记录锁，间隙锁，临键锁
属性锁包括共享锁，排他锁
意向锁包括意向共享锁，意向排他锁

- 非锁定的一致性读
在读已提交和可重复读的隔离级别之下，会使用非锁定的一致性读
读已提交，会读取被锁定行的最新一份快照数据；可重复读，会读取事务开始的版本

- 行锁的三种算法是什么？
Record lock 单个行记录上的锁
Gap Lock 间隙锁，锁定一个范围
next-key lock 锁定一个范围，并且锁定记录本身


- 如何解决幻读问题？底层怎么做的？
使用next-key lock算法

- 事务的四个特性如何实现？
原子性和持久性由redo log保证
隔离性由锁保证
一致性由undo log 保证
redo log是物理日志，undo log是逻辑日志
binlog 
用于复制，在主从复制中，从库利用主库上的binlog进行重播，实现主从同步。 
用于数据库的基于时间点的还原。
redo log只存在于innodb中，是循环写的，不能持久保存

- 事务的四个隔离级别如何实现的？
读未提交不需要锁
读已提交和可重复读是用mvcc实现的，
对于可重复读，会使用一致性视图实现
读已提交则是会使用当前视图实现

- mysql什么时候会加锁？
增删改会加锁
在查的时候使用for update来显式增加共享锁/排他锁

select ... lock in share mode;加共享锁。(其他事务可读，不可写)
select ... for update;加排它锁。(其他事务不可读，不可写)，这样，其他事务就不能对这条记录进行读取和更改了。

- 什么时候会加间隙锁？临键锁？记录锁？
对于指定查询某一条记录的加锁语句，如果该记录不存在，会产生记录锁和间隙锁，如果记录存在，则只会产生记录锁，如：WHERE `id` = 5 FOR UPDATE;
对于查找某一范围内的查询语句，会产生间隙锁，如：WHERE `id` BETWEEN 5 AND 7 FOR UPDATE;
在普通索引列上，不管是何种查询，只要加锁，都会产生间隙锁，这跟唯一索引不一样；
在普通索引跟唯一索引中，数据间隙的分析，数据行是优先根据普通索引排序，再根据唯一索引排序。

- 如何进行分库分表？
range 方案 ： 对于新库压力过大
hash取模方案： 扩容麻烦，每次需要计算新的hash值
一致性hash：

 - 可重复读级别下如何解决幻读的问题的？
 1. gap锁
 2. 悲观锁 乐观锁


 - 聚集索引树能存放多少条数据
 假设一行数据为1k
 那么一页可以存放16条数据
 主键大小为8字节，指针为6字节，
 一页上可以存放1170个指针
指向1170页
高度为2则为1170*16
为3则为1170*1170*16

 B+树比B树好在什么地方？
 B+树比较稳定，矮胖，方便范围查找



 